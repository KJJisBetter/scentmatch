# Baseline System Architecture - SCE-52 Cleanup

**Date:** 2025-08-20  
**Purpose:** Pre-cleanup baseline for critical code cleanup (SCE-52)  
**Git Backup Branch:** backup-before-cleanup-2025-08-20 (commit: c61eb8b)

## Executive Summary

This document captures the current state of the ScentMatch codebase before executing the critical code cleanup (SCE-52) that will remove 89% unused AI files and consolidate the system architecture.

## File Count Analysis

### Current State
- **Total TypeScript files analyzed:** 161
- **Total files in project:** ~12,342 (including all assets, configs, dependencies)
- **Files with imports:** 38 actively imported files
- **Unused files identified:** 123 files

### AI Files Breakdown
- **Total AI files:** 36 in `/lib/ai/` directory
- **Used AI files:** 13 files actively imported
- **Unused AI files:** 23 files (64% cleanup potential)
- **Essential AI files verified:** 4 files confirmed by grep analysis

## Essential AI Files (Verified Working)

Based on import analysis and grep verification, these 4 files are actively used:

1. **`lib/ai/ai-search.ts`** - Imported by 7 files
   - Used in: search routes, tests, AI-powered search features
   
2. **`lib/ai/recommendation-engine.ts`** - Imported by 5 files  
   - Used in: API routes (`/api/recommendations/feedback`), tests
   
3. **`lib/ai/thompson-sampling.ts`** - Imported by 2 files
   - Used in: recommendation feedback API routes
   
4. **`lib/ai/voyage-client.ts`** - Imported by 6 files
   - Used in: quiz engine, search routes, AI description generation

## Unused AI Files (Cleanup Candidates)

**23 unused AI files identified for removal:**

```
lib/ai/websocket-realtime-updates.ts
lib/ai/unified-recommendation-orchestrator.ts  
lib/ai/real-time-recommendations.ts
lib/ai/real-time-performance-monitor.ts
lib/ai/real-time-index.ts
lib/ai/real-time-features.ts
lib/ai/real-time-event-processor.ts
lib/ai/performance-monitoring.ts
lib/ai/openai-client.ts
lib/ai/hnsw-index-optimizer.ts
lib/ai/feedback-processor.ts
lib/ai/error-handling.ts
lib/ai/embedding-versioning.ts
lib/ai/description-generator.ts
lib/ai/cross-system-learning-integration.ts
lib/ai/collection-intelligence.ts
lib/ai/collection-insights.ts
lib/ai/collection-analysis-engine.ts
lib/ai/ai-health-recovery.ts
lib/ai/ai-cost-optimizer.ts
lib/ai/ab-testing.ts
lib/ai/ab-testing-framework.ts
```

## Additional Used AI Files (Keep)

**9 additional AI files are imported and should be preserved:**

```
lib/ai/vector-similarity.ts
lib/ai/vector-search-optimizer.ts
lib/ai/user-activity-tracker.ts
lib/ai/recommendation-cache-manager.ts
lib/ai/real-time-integration.ts
lib/ai/index.ts
lib/ai/embedding-pipeline.ts
lib/ai/contextual-bandit-system.ts
lib/ai/ai-config.ts
lib/ai/ai-client.ts
```

## Bundle Analysis Baseline

**Bundle analyzer configured and reports generated:**
- Location: `.next/analyze/`
  - `client.html` - Client-side bundle analysis
  - `nodejs.html` - Server-side bundle analysis  
  - `edge.html` - Edge runtime bundle analysis

**Build status:** ✅ Successful compilation in 10.0s
**Warnings:** 2 non-blocking ESLint warnings (React hooks, const preferences)

## Scripts Directory Analysis

**Current scripts count:** 56+ scripts in `/scripts/` directory
**Categories identified:**
- **Test/Debug scripts:** 31 one-off experiments (removal candidates)
- **Migration scripts:** Multiple approaches to same functionality
- **Essential tools:** Package.json referenced scripts, deployment tools

## Current System Architecture

### Working AI Recommendation Systems
1. **Primary:** `recommendation-engine.ts` with Thompson sampling
2. **Search:** `ai-search.ts` with Voyage embeddings  
3. **Vector Operations:** Voyage client with similarity scoring
4. **Caching:** Recommendation cache manager for performance

### Database Integration
- **PostgreSQL** with Supabase
- **Vector search** via pgvector extension
- **Embeddings** generated by Voyage AI API
- **Real-time** subscriptions via Supabase

### API Architecture
- **Next.js 15** App Router with API routes
- **TypeScript** strict mode enabled
- **Supabase Auth** for user management
- **Edge functions** for AI operations

## Cleanup Targets

### Phase 1: Safe File Removal
- Remove 23 unused AI files (verified zero imports)
- Estimated reduction: 32/36 AI files → 4 essential files (89% reduction)
- File count reduction: 161 → ~138 TypeScript files

### Phase 2: Bundle Optimization  
- Expected bundle size reduction from dead code elimination
- Faster development compilation times
- Cleaner dependency tree

### Phase 3: Architecture Simplification
- Single recommendation engine (remove conflicting systems)
- Consolidated script directory
- Clear system boundaries

## Risk Mitigation

### Backup Strategy
- **Git backup branch:** `backup-before-cleanup-2025-08-20`
- **Commit hash:** c61eb8b
- **Full project state** preserved including `.next/`, `node_modules/` references

### Rollback Plan
1. `git checkout backup-before-cleanup-2025-08-20`
2. Restore any accidentally removed essential files
3. Run `npm install` to restore dependencies
4. Verify functionality with test suite

### Verification Protocol
1. Import analysis confirms zero usage before deletion
2. Manual grep verification for essential files
3. Test suite execution after each batch removal
4. Bundle analysis comparison before/after

## Success Metrics

### Target Reductions
- **AI files:** 36 → 13 files (64% reduction achieved, targeting 89%)
- **Total files:** 161 → ~150 TypeScript files (~7% reduction)
- **Bundle size:** Baseline reports generated for comparison
- **Development speed:** Faster compilation and clearer architecture

### Quality Improvements
- **Developer clarity:** Understanding which AI systems are active
- **Maintenance burden:** Reduced surface area for updates
- **System reliability:** No conflicting recommendation engines
- **Performance:** Smaller bundles, faster loads

---

**Next Steps:** Execute systematic cleanup following tasks.md workflow starting with Task 2: AI Files Audit and Safe Removal